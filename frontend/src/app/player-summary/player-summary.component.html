<!-- Bootstrap 5 Stylesheet Link -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
  crossorigin="anonymous"
/>

<div class="container mt-5">
  <div class="card p-4">
    <div class="search-container text-center">
      <h2 class="mb-4">Search Players by Name</h2>

      <!-- Search Input Group -->
      <div class="input-group mb-3">
        <input
          type="text"
          class="form-control"
          [(ngModel)]="searchQuery"
          placeholder="Enter the player's Name"
          aria-label="Search Query"
          aria-describedby="search-button"
          (input)="onSearchChange(searchQuery)"
        />
        <button class="btn" id="search-button" (click)="fetchPlayerSummary(searchQuery)">
          Search
        </button>
      </div>

      <!-- Autocomplete Suggestions List -->
      <ul *ngIf="suggestions.length > 0" class="list-group mt-2">
        <li *ngFor="let suggestion of suggestions" (click)="onSelectPlayer(suggestion.name)" class="list-group-item list-group-item-action">
          {{ suggestion.name }}
        </li>
      </ul>

      <!-- Error or No Results Message -->
      <div *ngIf="!playerSummary && searchQuery && suggestions.length === 0" class="text-danger mt-3">
        <p>"{{ searchQuery }} not found"</p>
      </div>

      <!-- Player Summary Results -->
      <div *ngIf="playerSummary" class="mt-4">
        <h3>{{ playerSummary.name }}</h3>

        <!-- Display each game's summary -->
        <div *ngFor="let game of playerSummary.games" class="card mt-3">
          <div class="card-body">
            <h4 class="card-title">Game on {{ game.date }}</h4>
            
            <!-- Player Stats in Table Format with horizontal scroll on small screens -->
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Minutes</th>
                    <th>Points</th>
                    <th>Rebounds</th>
                    <th>Assists</th>
                    <th>Steals</th>
                    <th>Blocks</th>
                    <th>Turnovers</th>
                    <th>FG Made</th>
                    <th>FG Attempted</th>
                    <th>FG %</th>
                    <th>3PT Made</th>
                    <th>3PT Attempted</th>
                    <th>3PT %</th>
                    <th>FT Made</th>
                    <th>FT Attempted</th>
                    <th>FT %</th>
                    <th>OREB</th>
                    <th>DREB</th>
                    <th>PF</th>
                    <th>Offensive Fouls</th>
                    <th>Defensive Fouls</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>{{ game.minutes }}</td>
                    <td>{{ game.points }}</td>
                    <td>{{ game.offensiveRebounds + game.defensiveRebounds }}</td>
                    <td>{{ game.assists }}</td>
                    <td>{{ game.steals }}</td>
                    <td>{{ game.blocks }}</td>
                    <td>{{ game.turnovers }}</td>
                    <td>{{ game.twoPointersMade + game.threePointersMade }}</td>
                    <td>{{ game.twoPointersAttempted + game.threePointersAttempted }}</td>
                    <td>{{ calculateFG(game.threePointersAttempted, game.threePointersMade, game.twoPointersAttempted, game.twoPointersMade)}}</td>
                    <td>{{ game.threePointersMade }}</td>
                    <td>{{ game.threePointersAttempted }}</td>
                    <td>{{ calculate3PTFG(game.threePointersAttempted,game.threePointersMade) }}</td>
                    <td>{{ game.freeThrowsMade }}</td>
                    <td>{{ game.freeThrowsAttempted }}</td>
                    <td>{{ calculateFT_FG(game.freeThrowsAttempted, game.freeThrowsMade) }}%</td>
                    <td>{{ game.offensiveRebounds }}</td>
                    <td>{{ game.defensiveRebounds }}</td>
                    <td>{{ game.offensiveFouls + game.defensiveFouls}}</td>
                    <td>{{ game.offensiveFouls }}</td>
                    <td>{{ game.defensiveFouls }}</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Display shots taken in two columns -->
            <div *ngIf="game.shots.length > 0" class="mt-3">
              <h4>Shots Taken:</h4>
              <div class="row">
                <div *ngFor="let shot of game.shots" class="col-md-6">
                  <div class="list-group-item">
                    Shot {{ shot.isMake ? 'Made' : 'Missed' }} at {{ calculateDistance(shot.locationX, shot.locationY) | number: '1.1-1' }} ft from the basket
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
